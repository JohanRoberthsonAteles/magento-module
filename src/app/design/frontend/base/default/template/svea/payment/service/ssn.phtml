<?php
$_country = Mage::getSingleton('checkout/session')
    ->getQuote()
    ->getBillingAddress()
    ->getCountry();

$_lang = strtoupper(Mage::helper('svea_webpay')->__('lang_code'));

$_method = $this->getMethod();
if (empty($_method)) {
    $_class = $_code = '';
} else {
    $_code = $_method->getCode();
    $_class = 'svea-ssn-container-' . $_code;
}
?>

<div class="<?php echo $_class ?>">
    <div class="input-box">
        <label style="padding-right: 5px;">
            <input type="radio"
                   class="payment_form_customerType_0"
                   name="payment[svea_info][svea_customerType]" value="0"
                   checked> <?php echo Mage::helper('svea_webpay')->__('private'); ?>
        </label>
        <label>
            <input type="radio"
                   class="payment_form_customerType_1"
                   name="payment[svea_info][svea_customerType]"
                   value="1"> <?php echo Mage::helper('svea_webpay')->__('company'); ?>
        </label>
    </div>

    <!-- If Nordic countries show, show SSN input field -->
    <?php if (in_array($_country, array('SE', 'DK', 'NO', 'FI'))): ?>
        <label for="payment_form_ssn_<?php echo $_code ?>" class="required"><em>*</em><?php echo Mage::helper('svea_webpay')->__('text_ssn') ?>
            :</label>
        <label style="display:none;"
               for="payment_form_ssn_<?php echo $_code ?>" class="required">
            <em>*</em><?php echo Mage::helper('svea_webpay')->__('text_vat_no') . ":"; ?>
        </label>

        <div class="input-box">
            <input type="text" id="payment_form_ssn_<?php echo $_code ?>"
                   class="input-text required-entry"
                   name="payment[svea_info][svea_ssn]"/>
        </div>
    <?php endif; ?>

    <!-- If DE or NL, show dropdowns for birth date -->
    <?php if (in_array($_country, array('NL', 'DE'))): ?>
        <div class="forNLDE">
            <label for="payment_form_birthYear_<?php echo $_code ?>"
                   class="required"><em>*</em><?php echo Mage::helper('svea_webpay')->__('text_birthyear') . ":"; ?>
            </label>

            <div class="input-box">
                <select id="payment_form_birthYear_<?php echo $_code ?>"
                        name="payment[svea_info][svea_birthYear]"
                        class="required validate-select">
                    <option
                        value=""><?php echo $this->__('-- Select --') ?></option>
                    <?php $_currentYear = date('Y'); ?>
                    <?php for ($_year = $_currentYear - 100; $_year <= $_currentYear - 17; $_year++): ?>
                        <option
                            value="<?php echo $_year ?>"><?php printf("%04d", $_year) ?></option>
                    <?php endfor ?>
                </select>
            </div>
        </div>
        <div class="forNLDE">
            <label for="payment_form_birthMonth_<?php echo $_code ?>"
                   class="required"><em>*</em><?php echo Mage::helper('svea_webpay')->__('text_birthmonth') . ":"; ?>
            </label>

            <div class="input-box">
                <select id="payment_form_birthMonth_<?php echo $_code ?>"
                        name="payment[svea_info][svea_birthMonth]"
                        class="required validate-select">
                    <option
                        value=""><?php echo $this->__('-- Select --') ?></option>
                    <?php for ($_month = 1; $_month <= 12; $_month++): ?>
                        <option
                            value="<?php echo $_month ?>"><?php printf("%02d", $_month) ?></option>
                    <?php endfor ?>
                </select>
            </div>
        </div>
        <div class="forNLDE">
            <label for="payment_form_birthDay_<?php echo $_code ?>"
                   class="required"><em>*</em><?php echo Mage::helper('svea_webpay')->__('text_birthday') . ":"; ?>
            </label>

            <div class="input-box">
                <select id="payment_form_birthDay_<?php echo $_code ?>"
                        name="payment[svea_info][svea_birthDay]"
                        class="required validate-select">
                    <option
                        value=""><?php echo $this->__('-- Select --') ?></option>
                    <?php for ($_day = 1; $_day <= 31; $_day++): ?>
                        <option
                            value="<?php echo $_day ?>"><?php printf("%02d", $_day) ?></option>
                    <?php endfor ?>
                </select>
            </div>
        </div>
    <?php endif; ?>

    <!-- If NL, DE or FI show VAT no input -->
    <?php if (in_array($_country, array('NL', 'DE', 'FI'))): ?>
        <div class="forNLDEcompany" style="display:none;">
            <label for="payment_form_vatNo_<?php echo $_code ?>"
                   class="required"><em>*</em><?php echo Mage::helper('svea_webpay')->__('text_vat_no') . ":"; ?>
            </label>

            <div class="input-box">
                <input type="text"
                       title="payment_form_vatNo"
                       class="input-text required-entry"
                       id="payment_form_vatNo_<?php echo $_code ?>"
                       name="payment[svea_info][svea_vatNo]"/>
            </div>
        </div>
    <?php endif; ?>

    <!-- If NL show input field for initials -->
    <?php if ($_country == "NL"): ?>
        <div class="forNLDE forNL">
            <label for="payment_form_initials_<?php echo $_code ?>"
                   class="required"><em>*</em><?php echo Mage::helper('svea_webpay')->__('text_initials') . ":"; ?>
            </label>

            <div class="input-box">
                <input type="text"
                       title="payment_form_initials"
                       class="input-text required-entry"
                       id="payment_form_initials_<?php echo $_code ?>"
                       name="payment[svea_info][svea_initials]"/>
            </div>
        </div>
    <?php endif; ?>

    <!-- Hide get address button for FI, NL, NO and DE -->
    <?php if (in_array($_country, array('SE', 'DK'))): ?>
        <?php if (!$this->helper('svea_webpay')->usingQuickCheckout()): ?>
            <div id="showAddressBox_<?php echo $_code ?>">
                <label
                    for="sveaShowAddresses_<?php echo $_code ?>"><?php echo Mage::helper('svea_webpay')->__('invoice_address') . ":"; ?></label>

                <div class="sveaShowAddresses"
                     id="sveaShowAddresses_<?php echo $_code ?>"
                     style="display:inline-block;"></div>
            </div>
        <?php endif ?>
        <div>
            <select class="svea_address_selectbox"
                    style="display:none;margin-top:8px"></select>

            <div id="payment-method-buttons-container-<?php echo $_code ?>" class="buttons-set"
                 style="margin-top: 0 !important; border: 0 !important">
                <button class="button"
                        onclick="sveaGetAddress.call(this, '<?php echo $_code; ?>');"
                        type="button">
                    <span><span><?php echo Mage::helper('svea_webpay')->__('get_address'); ?></span></span>
                </button>
                <img id="sveaLoader_<?php echo $_code ?>"
                     style="display:none; float: right; margin:4px 6px 0 0;"
                     src="<?php echo $this->getSkinUrl('svea/images/ajax-loader.gif') ?>">
            </div>
        </div>
    <?php endif; ?>
    <input type="hidden" name="payment[svea_info][svea_addressSelector]"
           class="svea_address_selector">
</div>
<script>
    var currentCountry = <?php echo Mage::helper('core')->jsonEncode($_country) ?>;
    var usingQuickCheckout = <?php echo Mage::helper('core')->jsonEncode($this->helper('svea_webpay')->usingQuickCheckout()) ?>;
    var getAddressUrl = '<?php echo $this->getUrl('svea_webpay/service/getAddresses', array('_secure' => true)) ?>';
</script>